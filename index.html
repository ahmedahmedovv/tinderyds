<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tinder YDS">
<meta name="format-detection" content="telephone=no">
<meta name="theme-color" content="#f4ecd8">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¥</text></svg>">
    <title>Tinder YDS - Kelime KartlarÄ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f4ecd8;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .header {
            color: #5c4a32;
            padding: 2vh 4vw;
            width: 92%;
            max-width: 420px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5vh;
        }

        .header h1 {
            font-size: clamp(16px, 5vw, 22px);
            font-weight: 700;
            letter-spacing: -0.5px;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 2vw;
        }

        .icon-btn {
            background: transparent;
            border: 1.5px solid #c4b49a;
            color: #8b7355;
            width: clamp(28px, 8vw, 36px);
            height: clamp(28px, 8vw, 36px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
        }

        .icon-btn:active {
            background: #f0e6d3;
            border-color: #8b7355;
        }

        .icon-btn svg {
            width: clamp(14px, 4vw, 18px);
            height: clamp(14px, 4vw, 18px);
        }

        .streak-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(166, 92, 92, 0.15);
            padding: 0.8vh 2vw;
            border-radius: 20px;
            font-size: clamp(12px, 3.5vw, 14px);
        }

        .streak-badge span {
            font-size: clamp(10px, 3vw, 12px);
        }

        .stats {
            display: flex;
            justify-content: flex-start;
            gap: 6vw;
            font-size: clamp(11px, 3vw, 13px);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.3vh;
        }

        .stat-label {
            font-size: clamp(8px, 2.5vw, 10px);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.6;
            font-weight: 500;
        }

        .stat-item strong {
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 700;
        }

        .card-container {
            position: relative;
            width: 92%;
            max-width: 420px;
            height: calc(65vh - 100px);
            min-height: 320px;
            max-height: 480px;
            margin: 1.5vh auto;
            perspective: 1000px;
            flex: 1;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #fdf6e3;
            border-radius: 2vw;
            max-radius: 16px;
            box-shadow: 0 4px 20px rgba(92, 74, 50, 0.15);
            display: flex;
            flex-direction: column;
            padding: 3vh 4vw;
            transition: transform 0.25s ease, opacity 0.25s ease;
            cursor: grab;
            user-select: none;
            touch-action: none;
            overflow: hidden;
            border: 1px solid #e8dcc8;
        }

        .card:active {
            cursor: grabbing;
        }

        .card.swiping-left {
            transform: translateX(-150%) rotate(-30deg);
            opacity: 0;
        }

        .card.swiping-right {
            transform: translateX(150%) rotate(30deg);
            opacity: 0;
        }

        .card-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            padding: 2vh 5vw;
            border: 3px solid;
            border-radius: 2vw;
            max-radius: 12px;
            font-size: clamp(20px, 6vw, 32px);
            font-weight: bold;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.15s, transform 0.15s;
            z-index: 10;
            background: rgba(253, 246, 227, 0.98);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .card-badge.know {
            color: #5a7c5a;
            border-color: #5a7c5a;
            --rotation: 8deg;
        }

        .card-badge.dont-know {
            color: #a65c5c;
            border-color: #a65c5c;
            --rotation: -8deg;
        }

        .card-badge.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1) rotate(var(--rotation, 0deg));
        }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5vh;
            min-height: 0;
        }

        .content-scroll::-webkit-scrollbar {
            width: 3px;
        }

        .content-scroll::-webkit-scrollbar-thumb {
            background: #c4b49a;
            border-radius: 2px;
        }

        .word {
            font-size: clamp(20px, 6vw, 28px);
            font-weight: bold;
            color: #3d3229;
            text-align: center;
            margin-bottom: 1vh;
            margin-top: 0.5vh;
            flex-shrink: 0;
            font-family: Georgia, 'Times New Roman', serif;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #c4b49a, transparent);
            margin: 1vh 0 1.5vh 0;
            flex-shrink: 0;
        }

        .section-title {
            font-size: clamp(9px, 2.5vw, 11px);
            text-transform: uppercase;
            color: #8b7355;
            letter-spacing: 1px;
            margin-bottom: 0.8vh;
            flex-shrink: 0;
            font-weight: 600;
        }

        .definition {
            font-size: clamp(13px, 4vw, 16px);
            color: #4a3f35;
            line-height: 1.5;
            text-align: center;
            flex-shrink: 0;
            font-family: Georgia, 'Times New Roman', serif;
        }

        .example {
            font-size: clamp(13px, 4vw, 15px);
            color: #5c4a32;
            font-style: italic;
            line-height: 1.5;
            text-align: center;
            padding: 2vh 3vw;
            background: #f5efe3;
            border-radius: 2vw;
            max-radius: 12px;
            border: none;
            flex-shrink: 0;
            font-family: Georgia, 'Times New Roman', serif;
        }

        .example .highlight-word {
            font-weight: 700;
            color: #3d3229;
            font-style: normal;
            background: linear-gradient(120deg, #e8d4a8 0%, #e8d4a8 100%);
            background-repeat: no-repeat;
            background-size: 100% 40%;
            background-position: 0 88%;
            padding: 0 4px;
            border-radius: 2px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: #8b7355;
        }

        .spinner {
            width: clamp(28px, 8vw, 40px);
            height: clamp(28px, 8vw, 40px);
            border: 3px solid #e8dcc8;
            border-top: 3px solid #8b7355;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1vh;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .controls {
            display: flex;
            gap: 10vw;
            margin-top: 2vh;
            margin-bottom: calc(2vh + env(safe-area-inset-bottom));
        }

        .btn {
            width: clamp(48px, 14vw, 64px);
            height: clamp(48px, 14vw, 64px);
            border-radius: 50%;
            border: 2px solid;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
            box-shadow: 0 2px 10px rgba(92, 74, 50, 0.1);
        }

        .btn svg {
            width: clamp(20px, 5vw, 26px);
            height: clamp(20px, 5vw, 26px);
            stroke-width: 2.5;
        }

        .btn:hover {
            transform: scale(1.1);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-dont-know {
            background: transparent;
            border-color: #c4a8a8;
            color: #a65c5c;
        }

        .btn-dont-know:active {
            background: #a65c5c;
            border-color: #a65c5c;
        }

        .btn-dont-know:active svg {
            stroke: #fdf6e3;
        }

        .btn-know {
            background: transparent;
            border-color: #a8c4a8;
            color: #5a7c5a;
        }

        .btn-know:active {
            background: #5a7c5a;
            border-color: #5a7c5a;
        }

        .btn-know:active svg {
            stroke: #fdf6e3;
        }

        .empty-state {
            text-align: center;
            color: #5c4a32;
            padding: 4vh 5vw;
        }

        .empty-state h2 {
            font-size: clamp(18px, 5vw, 24px);
            margin-bottom: 2vh;
        }

        .empty-state p {
            font-size: clamp(12px, 3.5vw, 14px);
            opacity: 0.8;
            margin-bottom: 3vh;
        }

        .btn-primary {
            background: #fdf6e3;
            color: #5c4a32;
            border: 1px solid #c4b49a;
            padding: 1.5vh 6vw;
            border-radius: 25px;
            font-size: clamp(13px, 3.5vw, 15px);
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .progress-bar {
            width: 92%;
            max-width: 420px;
            height: 0.6vh;
            min-height: 3px;
            max-height: 6px;
            background: rgba(92, 74, 50, 0.2);
            border-radius: 2px;
            margin: 1vh auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #8b7355;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .daily-progress {
            width: 92%;
            max-width: 420px;
            margin: 0.5vh auto 1vh;
            display: flex;
            align-items: center;
            gap: 2vw;
        }

        .daily-progress-bar {
            flex: 1;
            height: 0.8vh;
            min-height: 5px;
            max-height: 10px;
            background: rgba(139, 115, 85, 0.2);
            border-radius: 1vh;
            overflow: hidden;
        }

        .daily-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e67e22, #f39c12);
            border-radius: 1vh;
            transition: width 0.5s ease;
        }

        .daily-progress-fill.complete {
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }

        .daily-progress-text {
            font-size: clamp(10px, 2.8vw, 12px);
            color: #8b7355;
            white-space: nowrap;
            font-weight: 500;
        }

        .streak-notification {
            position: fixed;
            top: 10vh;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: #fdf6e3;
            border: 2px solid #e67e22;
            border-radius: 2vw;
            padding: 2vh 4vw;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .streak-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .streak-notification-content {
            display: flex;
            align-items: center;
            gap: 3vw;
        }

        .streak-fire {
            font-size: clamp(24px, 6vw, 32px);
            animation: firePulse 0.5s ease infinite alternate;
        }

        @keyframes firePulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        .streak-title {
            font-size: clamp(14px, 4vw, 16px);
            font-weight: 700;
            color: #e67e22;
        }

        .streak-subtitle {
            font-size: clamp(11px, 3vw, 13px);
            color: #8b7355;
        }

        .level-indicator {
            position: absolute;
            top: 1.5vh;
            right: 3vw;
            font-size: clamp(9px, 2.5vw, 11px);
            color: #8b7355;
            background: #f0e6d3;
            padding: 0.4vh 1.5vw;
            border-radius: 8px;
        }



        .swipe-hint span {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(92, 74, 50, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            padding: 4vw;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #fdf6e3;
            border-radius: 3vw;
            max-width: 420px;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 2vh;
            right: 3vw;
            background: transparent;
            border: none;
            color: #8b7355;
            cursor: pointer;
            padding: 1vh;
            z-index: 10;
        }

        .modal-close svg {
            width: 24px;
            height: 24px;
        }

        .modal-header {
            padding: 3vh 4vw 2vh;
            text-align: center;
            border-bottom: 1px solid #e8dcc8;
        }

        .modal-header h2 {
            color: #5c4a32;
            font-size: clamp(18px, 5vw, 22px);
            margin: 0;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 2vh 4vw;
        }

        .info-section {
            margin-bottom: 3vh;
        }

        .info-section h3 {
            color: #5c4a32;
            font-size: clamp(14px, 4vw, 16px);
            margin-bottom: 1.5vh;
            font-weight: 600;
        }

        .info-text {
            color: #6b5a48;
            font-size: clamp(12px, 3.5vw, 14px);
            line-height: 1.6;
            margin-bottom: 2vh;
        }

        .swipe-demo {
            display: flex;
            flex-direction: column;
            gap: 1.5vh;
        }

        .swipe-item {
            display: flex;
            align-items: center;
            gap: 3vw;
            background: #f5efe3;
            padding: 1.5vh 3vw;
            border-radius: 2vw;
            transition: transform 0.2s, background 0.2s;
        }

        @media (min-width: 1024px) {
            .swipe-item:hover {
                background: #ebe1d3;
                transform: translateX(5px);
            }
        }

        .swipe-icon {
            font-size: 20px;
            font-weight: bold;
            color: #8b7355;
            width: 30px;
            text-align: center;
        }

        .swipe-item strong {
            color: #5c4a32;
            font-size: clamp(13px, 3.5vw, 14px);
            display: block;
            margin-bottom: 0.3vh;
        }

        .swipe-item p {
            color: #8b7355;
            font-size: clamp(11px, 3vw, 12px);
            margin: 0;
        }

        .swipe-item kbd {
            background: #f0e6d3;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #c4b49a;
            font-family: inherit;
            font-size: 11px;
            color: #5c4a32;
        }

        .levels-table {
            background: #f5efe3;
            border-radius: 2vw;
            overflow: hidden;
        }

        .level-row {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            padding: 1.2vh 3vw;
            font-size: clamp(11px, 3vw, 12px);
            color: #6b5a48;
            border-bottom: 1px solid #e8dcc8;
        }

        .levels-table.two-columns .level-row {
            grid-template-columns: 1fr 1fr;
        }

        .level-row:last-child {
            border-bottom: none;
        }

        .level-header {
            background: #e8dcc8;
            font-weight: 600;
            color: #5c4a32;
        }

        .level-row.highlight {
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }

        .tips-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tips-list li {
            padding: 1vh 0 1vh 3vw;
            color: #6b5a48;
            font-size: clamp(12px, 3.5vw, 13px);
            line-height: 1.5;
            position: relative;
        }

        .tips-list li::before {
            content: "â€¢";
            color: #8b7355;
            position: absolute;
            left: 0.5vw;
        }

        .stats-explained {
            display: flex;
            flex-direction: column;
            gap: 1.5vh;
        }

        .stat-explained {
            background: #f5efe3;
            padding: 1.5vh 3vw;
            border-radius: 2vw;
        }

        .stat-explained strong {
            color: #5c4a32;
            font-size: clamp(13px, 3.5vw, 14px);
            display: block;
            margin-bottom: 0.3vh;
        }

        .stat-explained p {
            color: #8b7355;
            font-size: clamp(11px, 3vw, 12px);
            margin: 0;
        }

        .modal-footer {
            padding: 2vh 4vw 3vh;
            text-align: center;
            border-top: 1px solid #e8dcc8;
        }

        /* Word List Modal Specific Styles */
        .word-list-modal .modal-header {
            padding: 2vh 4vw 1vh;
        }

        .word-list-tabs {
            display: flex;
            gap: 1vw;
            margin-top: 1.5vh;
        }

        .tab-btn {
            flex: 1;
            padding: 1vh 2vw;
            border: 1px solid #c4b49a;
            background: transparent;
            color: #8b7355;
            border-radius: 2vw;
            font-size: clamp(11px, 3vw, 13px);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #8b7355;
            color: #fdf6e3;
            border-color: #8b7355;
        }

        .word-list-search {
            padding: 1vh 4vw;
            border-bottom: 1px solid #e8dcc8;
        }

        .word-list-search input {
            width: 100%;
            padding: 1.2vh 3vw;
            border: 1px solid #c4b49a;
            border-radius: 2vw;
            background: #f5efe3;
            color: #5c4a32;
            font-size: clamp(13px, 3.5vw, 14px);
            outline: none;
        }

        .word-list-search input::placeholder {
            color: #a09078;
        }

        .word-list-body {
            padding: 1vh 0 0 0 !important;
        }

        .word-list-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2vw;
            padding: 1.5vh 4vw;
            background: #f5efe3;
            border-bottom: 1px solid #e8dcc8;
        }

        .summary-item {
            text-align: center;
        }

        .summary-number {
            display: block;
            font-size: clamp(16px, 4.5vw, 20px);
            font-weight: 700;
            color: #5c4a32;
        }

        .summary-label {
            font-size: clamp(9px, 2.5vw, 11px);
            color: #8b7355;
            text-transform: uppercase;
        }

        .word-list-container {
            padding: 1vh 4vw 2vh;
            overflow-y: auto;
            max-height: calc(85vh - 200px);
        }

        .word-list-container::-webkit-scrollbar {
            width: 4px;
        }

        .word-list-container::-webkit-scrollbar-thumb {
            background: #c4b49a;
            border-radius: 2px;
        }

        .word-group {
            margin-bottom: 2vh;
        }

        .word-group-title {
            font-size: clamp(11px, 3vw, 12px);
            color: #8b7355;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1vh;
            padding-left: 1vw;
        }

        .word-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5vh 3vw;
            background: #fdf6e3;
            border: 1px solid #e8dcc8;
            border-radius: 2vw;
            margin-bottom: 1vh;
            transition: all 0.2s;
        }

        .word-item:active {
            background: #f5efe3;
        }

        .word-info {
            flex: 1;
        }

        .word-name {
            font-size: clamp(14px, 4vw, 16px);
            font-weight: 600;
            color: #5c4a32;
            margin-bottom: 0.3vh;
        }

        .word-status {
            display: flex;
            align-items: center;
            gap: 2vw;
        }

        .level-badge {
            font-size: clamp(10px, 2.8vw, 11px);
            padding: 0.3vh 1.5vw;
            border-radius: 10px;
            background: #e8dcc8;
            color: #8b7355;
        }

        .level-badge.learned {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .level-badge.new {
            background: #f5f5f5;
            color: #9e9e9e;
        }

        .next-review {
            font-size: clamp(9px, 2.5vw, 10px);
            color: #a09078;
        }

        .word-progress {
            width: clamp(40px, 12vw, 60px);
            height: 4px;
            background: #e8dcc8;
            border-radius: 2px;
            overflow: hidden;
        }

        .word-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8b7355, #a08060);
            border-radius: 2px;
            transition: width 0.3s;
        }

        .word-progress-bar.learned {
            background: linear-gradient(90deg, #4caf50, #66bb6a);
        }

        .empty-list {
            text-align: center;
            padding: 4vh 2vw;
            color: #8b7355;
        }

        .empty-list-icon {
            font-size: 32px;
            margin-bottom: 1vh;
        }

        .empty-list-text {
            font-size: clamp(12px, 3.5vw, 14px);
        }

        /* Responsive for very small screens */
        @media (max-height: 700px) {
            .header {
                padding: 1.5vh 4vw;
            }

            .header-top {
                margin-bottom: 1vh;
            }

            .card-container {
                min-height: 280px;
            }

            .word {
                margin-bottom: 0.8vh;
            }

            .example {
                padding: 1.5vh 3vw;
            }

            .modal-content {
                max-height: 90vh;
            }
        }

        /* Large screens */
        @media (min-width: 768px) {
            .card-container {
                max-width: 480px;
                max-height: 600px;
            }

            .header {
                max-width: 480px;
            }

            .modal-content {
                border-radius: 16px;
            }

            .swipe-item, .level-row, .stat-explained, .levels-table {
                border-radius: 12px;
            }

            .word-list-modal .modal-content {
                max-width: 500px;
            }

            .word-item, .tab-btn, .word-list-search input {
                border-radius: 12px;
            }
        }

        /* ============================================
           IPHONE 13 MINI SPECIFIC OPTIMIZATIONS
           Exact dimensions: 375 x 812 CSS points
           Safe areas: 44px (status bar), 34px (home indicator)
           ============================================ */
        
        /* Target iPhone 13 Mini specifically with device-pixel-ratio check */
        @media only screen 
            and (device-width: 375px) 
            and (device-height: 812px) 
            and (-webkit-device-pixel-ratio: 3) {
            
            /* Root adjustments for perfect fit */
            body {
                padding-top: max(44px, env(safe-area-inset-top));
                padding-bottom: max(34px, env(safe-area-inset-bottom));
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }
            
            /* Header: Compact but readable */
            .header {
                padding: 8px 16px 6px 16px;
                width: 100%;
                max-width: 343px;
            }

            .header-top {
                margin-bottom: 6px;
            }
            
            .header h1 {
                font-size: 17px;
                letter-spacing: -0.3px;
            }

            .header-actions {
                gap: 8px;
            }

            .icon-btn {
                width: 32px;
                height: 32px;
                border-width: 1.5px;
            }

            .icon-btn svg {
                width: 16px;
                height: 16px;
            }

            .streak-badge {
                padding: 4px 10px;
                font-size: 13px;
                gap: 4px;
            }

            .streak-badge span {
                font-size: 12px;
            }
            
            .stats {
                gap: 24px;
                font-size: 12px;
            }

            .stat-label {
                font-size: 9px;
                letter-spacing: 0.3px;
            }

            .stat-item strong {
                font-size: 15px;
            }
            
            /* Daily progress bar */
            .daily-progress {
                width: 343px;
                margin: 4px auto 8px auto;
                gap: 8px;
            }

            .daily-progress-bar {
                height: 5px;
                border-radius: 2.5px;
            }

            .daily-progress-text {
                font-size: 11px;
            }

            /* Progress bar */
            .progress-bar {
                width: 343px;
                height: 3px;
                margin: 4px auto 6px auto;
            }
            
            /* Card container: Maximize available space */
            .card-container {
                width: 343px;
                height: 456px;
                min-height: unset;
                max-height: unset;
                margin: 4px auto;
            }
            
            .card {
                padding: 16px;
                border-radius: 16px;
            }
            
            .level-indicator {
                top: 12px;
                right: 14px;
                font-size: 10px;
                padding: 3px 10px;
                border-radius: 6px;
            }
            
            .word {
                font-size: 24px;
                margin: 4px 0 6px 0;
            }
            
            .divider {
                margin: 6px 0 10px 0;
                height: 1px;
            }
            
            .section-title {
                font-size: 9px;
                margin-bottom: 6px;
                letter-spacing: 0.8px;
            }
            
            .definition {
                font-size: 15px;
                line-height: 1.5;
            }
            
            .example {
                font-size: 14px;
                line-height: 1.55;
                padding: 12px 14px;
                border-radius: 12px;
                margin-top: 2px;
            }

            .example .highlight-word {
                padding: 0 3px;
            }
            
            .content-scroll {
                gap: 10px;
            }
            
            /* Card badge when swiping */
            .card-badge {
                font-size: 24px;
                padding: 10px 20px;
                border-width: 3px;
                border-radius: 10px;
            }
            
            /* Controls: Positioned nicely above home indicator */
            .controls {
                gap: 60px;
                margin-top: 10px;
                margin-bottom: calc(8px + env(safe-area-inset-bottom));
            }
            
            .btn {
                width: 56px;
                height: 56px;
                border-width: 2px;
            }

            .btn svg {
                width: 24px;
                height: 24px;
            }

            /* Loading spinner */
            .spinner {
                width: 36px;
                height: 36px;
                border-width: 3px;
            }

            /* Empty state adjustments */
            .empty-state {
                padding: 20px;
            }

            .empty-state h2 {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .empty-state p {
                font-size: 14px;
                margin-bottom: 16px;
            }

            .btn-primary {
                padding: 12px 24px;
                font-size: 15px;
                border-radius: 20px;
            }

            /* Streak notification */
            .streak-notification {
                top: 60px;
                padding: 12px 16px;
                border-radius: 12px;
            }

            .streak-fire {
                font-size: 28px;
            }

            .streak-title {
                font-size: 15px;
            }

            .streak-subtitle {
                font-size: 12px;
            }

            /* Modal adjustments for iPhone 13 Mini */
            .modal-overlay {
                padding: 16px;
                padding-top: max(44px, env(safe-area-inset-top));
                padding-bottom: max(34px, env(safe-area-inset-bottom));
            }

            .modal-content {
                border-radius: 20px;
                max-height: calc(100vh - 88px);
            }

            .modal-close {
                top: 12px;
                right: 12px;
            }

            .modal-close svg {
                width: 22px;
                height: 22px;
            }

            .modal-header {
                padding: 16px 16px 12px 16px;
            }

            .modal-header h2 {
                font-size: 18px;
            }

            .modal-body {
                padding: 12px 16px;
            }

            .info-section {
                margin-bottom: 16px;
            }

            .info-section h3 {
                font-size: 15px;
                margin-bottom: 8px;
            }

            .info-text {
                font-size: 13px;
                line-height: 1.5;
                margin-bottom: 12px;
            }

            .swipe-item {
                padding: 10px 12px;
                gap: 12px;
            }

            .swipe-icon {
                font-size: 18px;
                width: 28px;
            }

            .swipe-item strong {
                font-size: 14px;
            }

            .swipe-item p {
                font-size: 12px;
            }

            .swipe-item kbd {
                font-size: 10px;
                padding: 2px 6px;
            }

            .level-row {
                padding: 8px 12px;
                font-size: 12px;
            }

            .tips-list li {
                font-size: 13px;
                padding: 6px 0 6px 16px;
            }

            .stat-explained {
                padding: 10px 12px;
            }

            .stat-explained strong {
                font-size: 14px;
            }

            .stat-explained p {
                font-size: 12px;
            }

            .modal-footer {
                padding: 12px 16px 16px 16px;
            }

            /* Word list modal specific */
            .word-list-modal .modal-header {
                padding: 12px 16px 8px 16px;
            }

            .word-list-tabs {
                margin-top: 10px;
                gap: 8px;
            }

            .tab-btn {
                padding: 8px 12px;
                font-size: 13px;
                border-radius: 8px;
            }

            .word-list-search {
                padding: 8px 16px;
            }

            .word-list-search input {
                padding: 10px 14px;
                font-size: 15px;
                border-radius: 10px;
            }

            .word-list-content {
                padding: 8px 16px;
            }

            .word-item {
                padding: 10px 12px;
                border-radius: 10px;
            }

            .word-item-text {
                font-size: 15px;
            }

            .word-item-meta {
                font-size: 12px;
            }

            .word-item-status {
                font-size: 11px;
                padding: 3px 8px;
            }

            .word-list-empty {
                padding: 30px 20px;
            }

            .word-list-empty-icon {
                font-size: 36px;
                margin-bottom: 12px;
            }

            .word-list-empty p {
                font-size: 14px;
            }
        }

        /* Fallback for similar small iPhones (12 mini, SE, etc.) */
        @media only screen 
            and (max-width: 380px) 
            and (max-height: 815px) 
            and (-webkit-device-pixel-ratio: 3) {
            
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .card-container {
                width: 92%;
                height: calc(100vh - 220px);
                max-height: 480px;
            }
            
            .header {
                width: 92%;
                padding: 10px 16px;
            }
            
            .controls {
                margin-bottom: calc(10px + env(safe-area-inset-bottom));
            }
        }

        /* ============================================
           JS-BASED DEVICE CLASSES
           ============================================ */
        
        /* iPhone 13 Mini class added by JavaScript detection */
        body.iphone-13-mini {
            /* Ensures smooth scrolling on iPhone 13 Mini */
            -webkit-overflow-scrolling: touch;
        }
        
        /* Standalone/PWA mode adjustments */
        body.standalone {
            /* Additional padding for standalone mode */
            padding-top: env(safe-area-inset-top);
        }
        
        body.standalone .streak-notification {
            /* Adjust notification position in standalone mode */
            top: calc(env(safe-area-inset-top) + 10px);
        }

        /* ============================================
           DESKTOP & TABLET ENHANCEMENTS
           ============================================ */

        /* Tablet (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            body {
                padding: 20px;
            }

            .header {
                max-width: 500px;
                padding: 20px;
            }

            .card-container {
                max-width: 500px;
                height: 500px;
                max-height: 550px;
            }

            .card {
                padding: 30px;
                border-radius: 20px;
            }

            .word {
                font-size: 32px;
            }

            .definition {
                font-size: 17px;
            }

            .example {
                font-size: 16px;
                padding: 20px;
                border-radius: 16px;
            }

            .controls {
                gap: 60px;
                margin-top: 25px;
                margin-bottom: 25px;
            }

            .btn {
                width: 72px;
                height: 72px;
            }

            .btn svg {
                width: 30px;
                height: 30px;
            }

            /* Show keyboard hints on tablet */
            .keyboard-hints {
                display: flex;
                gap: 40px;
                margin-top: 10px;
                color: #8b7355;
                font-size: 13px;
            }
        }

        /* Laptop & Desktop (1024px+) */
        @media (min-width: 1024px) {
            body {
                padding: 30px;
                justify-content: flex-start;
                min-height: 100vh;
            }

            .header {
                max-width: 600px;
                padding: 24px;
                margin-top: 10px;
            }

            .header h1 {
                font-size: 26px;
            }

            .icon-btn {
                width: 44px;
                height: 44px;
                transition: all 0.2s ease;
            }

            .icon-btn:hover {
                background: #f0e6d3;
                border-color: #8b7355;
                transform: scale(1.1);
            }

            .streak-badge {
                padding: 10px 16px;
                font-size: 15px;
            }

            .stats {
                gap: 40px;
                font-size: 14px;
            }

            .stat-item strong {
                font-size: 20px;
            }

            .card-container {
                max-width: 600px;
                width: 90%;
                height: 520px;
                max-height: 600px;
                margin: 20px auto;
            }

            .card {
                padding: 35px 40px;
                border-radius: 24px;
                box-shadow: 0 8px 40px rgba(92, 74, 50, 0.12);
                transition: transform 0.25s ease, opacity 0.25s ease, box-shadow 0.3s ease;
            }

            .card:hover {
                box-shadow: 0 12px 50px rgba(92, 74, 50, 0.18);
            }

            .word {
                font-size: 36px;
                margin-bottom: 12px;
            }

            .divider {
                margin: 12px 0 18px 0;
            }

            .section-title {
                font-size: 12px;
                margin-bottom: 10px;
            }

            .definition {
                font-size: 18px;
                line-height: 1.6;
                max-width: 90%;
                margin: 0 auto;
            }

            .example {
                font-size: 17px;
                padding: 24px 28px;
                border-radius: 16px;
                margin-top: 10px;
                line-height: 1.6;
            }

            .card-badge {
                font-size: 36px;
                padding: 16px 32px;
                border-width: 4px;
                border-radius: 12px;
            }

            .level-indicator {
                font-size: 12px;
                padding: 6px 14px;
                top: 20px;
                right: 24px;
            }

            .controls {
                gap: 80px;
                margin-top: 30px;
                margin-bottom: 30px;
            }

            .btn {
                width: 80px;
                height: 80px;
                transition: all 0.2s ease;
            }

            .btn svg {
                width: 32px;
                height: 32px;
            }

            .btn:hover {
                transform: scale(1.15);
            }

            .btn-dont-know:hover {
                background: rgba(166, 92, 92, 0.1);
                border-color: #a65c5c;
            }

            .btn-know:hover {
                background: rgba(90, 124, 90, 0.1);
                border-color: #5a7c5a;
            }

            /* Keyboard hints */
            .keyboard-hints {
                display: flex;
                gap: 60px;
                margin-top: 15px;
                color: #8b7355;
                font-size: 14px;
            }

            .keyboard-hints kbd {
                background: #f0e6d3;
                padding: 4px 10px;
                border-radius: 6px;
                border: 1px solid #c4b49a;
                font-family: inherit;
                font-size: 13px;
            }

            /* Progress bars */
            .progress-bar {
                max-width: 600px;
                height: 6px;
            }

            .daily-progress {
                max-width: 600px;
                gap: 16px;
            }

            .daily-progress-bar {
                height: 10px;
            }

            .daily-progress-text {
                font-size: 13px;
            }

            /* Modal enhancements */
            .modal-content {
                max-width: 600px;
                border-radius: 24px;
            }

            .modal-header {
                padding: 28px 32px 20px;
            }

            .modal-header h2 {
                font-size: 24px;
            }

            .modal-body {
                padding: 24px 32px;
            }

            .modal-close {
                top: 20px;
                right: 24px;
                padding: 12px;
                cursor: pointer;
                border-radius: 50%;
                transition: background 0.2s;
            }

            .modal-close:hover {
                background: #f0e6d3;
            }

            /* Word list modal */
            .word-list-modal .modal-content {
                max-width: 650px;
            }

            .word-list-container {
                max-height: calc(85vh - 220px);
            }

            .word-item {
                padding: 16px 20px;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .word-item:hover {
                background: #f5efe3;
                transform: translateX(4px);
            }

            .tab-btn {
                padding: 12px 20px;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .tab-btn:hover:not(.active) {
                background: rgba(139, 115, 85, 0.1);
            }

            /* Notification */
            .streak-notification {
                border-radius: 16px;
                padding: 20px 32px;
            }
        }

        /* Large Desktop (1440px+) */
        @media (min-width: 1440px) {
            .header, .card-container, .progress-bar, .daily-progress {
                max-width: 700px;
            }

            .card-container {
                height: 580px;
                max-height: 650px;
            }

            .word {
                font-size: 40px;
            }

            .definition {
                font-size: 20px;
            }

            .example {
                font-size: 18px;
            }

            .word-list-modal .modal-content {
                max-width: 750px;
            }
        }

        /* Hide keyboard hints on mobile */
        .keyboard-hints {
            display: none;
        }

        @media (min-width: 768px) {
            .keyboard-hints {
                display: flex;
                justify-content: center;
            }
        }

        /* Touch device adjustments */
        @media (hover: none) {
            .btn:hover {
                transform: none;
            }

            .icon-btn:hover {
                transform: none;
            }

            .word-item:hover {
                transform: none;
            }
        }

        /* Landscape mode on mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 10px;
            }

            .header {
                padding: 10px 16px;
            }

            .header-top {
                margin-bottom: 8px;
            }

            .card-container {
                height: 200px;
                min-height: 180px;
                margin: 8px auto;
            }

            .card {
                padding: 12px 16px;
            }

            .word {
                font-size: 18px;
                margin-bottom: 4px;
            }

            .divider {
                margin: 4px 0;
            }

            .section-title {
                font-size: 8px;
                margin-bottom: 2px;
            }

            .definition {
                font-size: 12px;
                line-height: 1.4;
            }

            .example {
                font-size: 11px;
                padding: 8px 12px;
                margin-top: 4px;
            }

            .controls {
                margin-top: 10px;
                margin-bottom: 10px;
                gap: 40px;
            }

            .btn {
                width: 44px;
                height: 44px;
            }

            .btn svg {
                width: 20px;
                height: 20px;
            }

            .keyboard-hints {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <h1>Tinder YDS</h1>
            <div class="header-actions">
                <button class="icon-btn" onclick="showWordListModal()" title="Word List">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                        <path d="M9 6h11M9 12h11M9 18h11M5 6h.01M5 12h.01M5 18h.01"/>
                    </svg>
                </button>
                <button class="icon-btn" onclick="showInfoModal()" title="How to use">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4M12 8h.01"/>
                    </svg>
                </button>
                <div class="streak-badge">
                    <span>ðŸ”¥</span>
                    <strong id="streakCount">0</strong>
                </div>
            </div>
        </div>
        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">Review</span>
                <strong id="toReviewCount">0</strong>
            </div>
            <div class="stat-item">
                <span class="stat-label">Learned</span>
                <strong id="learnedCount">0</strong>
            </div>
        </div>
    </div>

    <!-- Word List Modal -->
    <div class="modal-overlay" id="wordListModal" onclick="closeWordListModal(event)">
        <div class="modal-content word-list-modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeWordListModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            
            <div class="modal-header">
                <h2>ðŸ“– Word List</h2>
                <div class="word-list-tabs">
                    <button class="tab-btn active" onclick="filterWords('all')" data-filter="all">All</button>
                    <button class="tab-btn" onclick="filterWords('learning')" data-filter="learning">Learning</button>
                    <button class="tab-btn" onclick="filterWords('learned')" data-filter="learned">Learned</button>
                </div>
            </div>
            
            <div class="word-list-search">
                <input type="text" id="wordSearch" placeholder="Search words..." oninput="searchWords()">
            </div>
            
            <div class="modal-body word-list-body">
                <div class="word-list-summary">
                    <div class="summary-item">
                        <span class="summary-number" id="totalWordsCount">0</span>
                        <span class="summary-label">Total</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-number" id="learningWordsCount">0</span>
                        <span class="summary-label">Learning</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-number" id="learnedWordsCount">0</span>
                        <span class="summary-label">Learned</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-number" id="progressPercent">0%</span>
                        <span class="summary-label">Progress</span>
                    </div>
                </div>
                
                <div class="word-list-container" id="wordListContainer">
                    <!-- Words will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="infoModal" onclick="closeInfoModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeInfoModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            
            <div class="modal-header">
                <h2>ðŸ“š How to Use</h2>
            </div>
            
            <div class="modal-body">
                <section class="info-section">
                    <h3>ðŸŽ¯ How to Use</h3>
                    <p class="info-text">Swipe through flashcards to review vocabulary. Each card shows two connected example sentences using academic linking words (furthermore, however, therefore, consequently, etc.).</p>
                    <div class="swipe-demo">
                        <div class="swipe-item">
                            <span class="swipe-icon">â†</span>
                            <div>
                                <strong>Don't Know</strong>
                                <p>Swipe left, tap X, or press <kbd>â†</kbd> arrow. Word will appear again soon for review.</p>
                            </div>
                        </div>
                        <div class="swipe-item">
                            <span class="swipe-icon">â†’</span>
                            <div>
                                <strong>Know It</strong>
                                <p>Swipe right, tap âœ“, or press <kbd>â†’</kbd> arrow. Word advances to next level and appears less frequently.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="info-section">
                    <h3>ðŸ”¥ Daily Streak System</h3>
                    <p class="info-text">Review <strong>at least 10 words every day</strong> to build your streak. Both correct and incorrect answers count - what matters is daily practice!</p>
                    
                    <div class="levels-table two-columns">
                        <div class="level-row level-header">
                            <span>Daily Words</span>
                            <span>Result</span>
                        </div>
                        <div class="level-row">
                            <span>10+ words</span>
                            <span style="color: #27ae60; font-weight: 600;">âœ“ Streak +1 ðŸ”¥</span>
                        </div>
                        <div class="level-row">
                            <span>0-9 words</span>
                            <span style="color: #c0392b;">âœ— Streak breaks</span>
                        </div>
                        <div class="level-row">
                            <span>Skip a day</span>
                            <span style="color: #c0392b;">âœ— Streak resets to 0</span>
                        </div>
                    </div>
                </section>

                <section class="info-section">
                    <h3>ðŸ§  Spaced Repetition Levels</h3>
                    <p class="info-text">Words advance through 7 levels. Higher levels = longer intervals between reviews. This scientifically optimizes long-term memory retention.</p>
                    
                    <div class="levels-table">
                        <div class="level-row level-header">
                            <span>Level</span>
                            <span>Next Review</span>
                            <span>Status</span>
                        </div>
                        <div class="level-row"><span>0</span><span>Immediate</span><span>New</span></div>
                        <div class="level-row"><span>1</span><span>1 day</span><span>Learning</span></div>
                        <div class="level-row"><span>2</span><span>3 days</span><span>Learning</span></div>
                        <div class="level-row"><span>3</span><span>7 days</span><span>Learning</span></div>
                        <div class="level-row highlight"><span>4+</span><span>14-120 days</span><span>âœ“ Mastered</span></div>
                    </div>
                </section>

                <section class="info-section">
                    <h3>ðŸ’¡ Tips for Success</h3>
                    <ul class="tips-list">
                        <li><strong>Review 10 words daily</strong> to maintain your streak ðŸ”¥</li>
                        <li>Both "Know" and "Don't Know" count toward daily goal</li>
                        <li>Be honest - mark "Don't Know" if you're unsure</li>
                        <li>Read example sentences aloud for better retention</li>
                        <li>Study linking words to improve academic writing skills</li>
                        <li>Try to use new words in your own sentences</li>
                        <li>Check Word List to see all your progress</li>
                    </ul>
                </section>

                <section class="info-section">
                    <h3>ðŸ”— Academic Linking Words</h3>
                    <p class="info-text">Example sentences use academic linking words to connect ideas. These words are essential for academic writing and coherence.</p>
                    
                    <div class="levels-table two-columns">
                        <div class="level-row level-header">
                            <span>Category</span>
                            <span>Examples</span>
                        </div>
                        <div class="level-row"><span>Addition</span><span>furthermore, moreover</span></div>
                        <div class="level-row"><span>Contrast</span><span>however, nevertheless</span></div>
                        <div class="level-row"><span>Cause/Effect</span><span>therefore, consequently</span></div>
                        <div class="level-row"><span>Sequence</span><span>subsequently, initially</span></div>
                    </div>
                </section>

                <section class="info-section">
                    <h3>ðŸ“Š Understanding Your Stats</h3>
                    <div class="stats-explained">
                        <div class="stat-explained">
                            <strong>Review</strong>
                            <p>Words due for review today based on spaced repetition</p>
                        </div>
                        <div class="stat-explained">
                            <strong>Learned</strong>
                            <p>Words at Level 4+ (mastered, appear less frequently)</p>
                        </div>
                        <div class="stat-explained">
                            <strong>ðŸ”¥ Streak</strong>
                            <p>Consecutive days with 10+ words reviewed</p>
                        </div>
                        <div class="stat-explained">
                            <strong>Progress Bar</strong>
                            <p>Orange = working toward daily goal, Green = goal met!</p>
                        </div>
                    </div>
                </section>
            </div>
            
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeInfoModal()">Got it!</button>
            </div>
        </div>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <div class="daily-progress">
        <div class="daily-progress-bar">
            <div class="daily-progress-fill" id="dailyProgressFill" style="width: 0%"></div>
        </div>
        <span class="daily-progress-text" id="dailyProgressText">0/10 words today</span>
    </div>

    <div class="card-container" id="cardContainer">
        <!-- Cards will be injected here -->
    </div>

    <div class="controls" id="controls">
        <button class="btn btn-dont-know" onclick="handleDontKnow()" title="Don't Know (Left Arrow or Swipe Left)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <button class="btn btn-know" onclick="handleKnow()" title="Know It (Right Arrow or Swipe Right)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 6L9 17l-5-5"/>
            </svg>
        </button>
    </div>

    <!-- Keyboard hints for desktop users -->
    <div class="keyboard-hints" id="keyboardHints">
        <span><kbd>â†</kbd> Don't Know</span>
        <span><kbd>â†’</kbd> Know It</span>
    </div>

    <script src="linkingwords.js"></script>
    <script>
        // Word list from mywords.js
        const MYWORDS = [
            "Abide by", "Abnormal", "Abolish", "Abort", "Abrupt", "Absurd", "Abundant", "Academic",
            "Accelerate", "Accessible", "Accidental", "Accommodate", "Accomplish", "Account for",
            "Accountable", "Accumulate", "Accurate", "Accurately", "Accusation", "Accuse of",
            "Accustomed", "Achieve", "Acknowledge", "Acquainted with", "Acquire", "Act out",
            "Activate", "Adapt", "Adapt to", "Addicted to", "Adequate", "Adjust", "Admire",
            "Adopt", "Advance", "Advocate", "Affect", "Afford", "Affordable", "Afterwards",
            "Agreeable", "Alarming", "Alert", "Along with", "Alter", "Ambitious", "Amusing",
            "Ancient", "Annoyed", "Anticipate", "Antique", "Anxious", "Apparent", "Apparently",
            "Appealing", "Applaud", "Appropriately", "Approve of", "Approximate", "Approximately",
            "Arise", "Artificial", "Ascending", "Aspect", "Assault", "Assemble", "Assess",
            "Assign", "Assist", "Associate", "Assorted", "Assume", "Assure", "Astonish",
            "Astonished", "Astonishing", "At all costs", "Attach importance to", "Attached",
            "Attain", "Attempt", "Attentive", "Attribute", "Authentic", "Authorize", "Available",
            "Awareness", "Bankrupt", "Barely", "Be characterized by", "Be composed of",
            "Be engaged in", "Be found in", "Be made up of", "Be marked by", "Be seen in",
            "Be traced back to", "Become extinct", "Beneficial", "Betray", "Biased", "Bitter",
            "Bizarre", "Blame for", "Blend", "Blooming", "Blossom", "Blow up", "Blurred",
            "Bold", "Boldly", "Bond", "Boost", "Bothered", "Bottomless", "Bravely",
            "Break away from", "Break off", "Break out", "Break out of", "Breath-taking",
            "Brilliant", "Bring down", "Bring forward", "Bring in", "Bring out", "Bring over",
            "Bring up", "Bring upon", "Broaden", "Brutal", "Build in", "Bump into",
            "By definition", "By means of", "By nature", "By no means", "Candid", "Capable",
            "Casually", "Catch on", "Catch up with", "Cautious", "Centrally", "Certainty",
            "Certify", "Challenging", "Characterize", "Charge with", "Charming", "Cite",
            "Civilized", "Clashing", "Clarify", "Classify", "Collective", "Colonize",
            "Combine", "Come into being", "Come up with", "Command", "Commercial", "Commit",
            "Commonplace", "Comparable", "Compared with", "Compatible", "Competent", "Complex",
            "Complicated", "Composed of", "Concentrate", "Concerned", "Conclude", "Conclusive",
            "Conclusively", "Concrete", "Conduct", "Confident", "Confidently", "Confirm",
            "Conflict", "Confront", "Confronting", "Confuse", "Confusing", "Conscious",
            "Consciously", "Conserve", "Consider", "Considerably", "Considerate", "Considerately",
            "Consistent", "Consist of", "Construct", "Consume", "Contain", "Contemporary",
            "Continuous", "Continuously", "Contradicting", "Contradictory", "Contrary to",
            "Contribute", "Controversial", "Conventional", "Convert into", "Convey",
            "Convincing", "Convincingly", "Cooperate", "Cooperative", "Cope with", "Corrupt",
            "Countless", "Courageously", "Cowardly", "Cozy", "Creative", "Credible", "Credit",
            "Deceitful", "Deceitfully", "Deceive", "Decent", "Decently", "Deceptive",
            "Deceptively", "Decisive", "Decisively", "Decline", "Defeat", "Defectively",
            "Defence", "Defenceless", "Defiant", "Defiantly", "Deficient", "Deficiently",
            "Define", "Definite", "Degenerate", "Delude", "Delusively", "Demanding",
            "Demolish", "Demonstrate", "Densely", "Deny", "Depart", "Depend on", "Dependable",
            "Dependent on", "Depict", "Deprived of", "Derive", "Descend", "Desert", "Deserve",
            "Design", "Desire", "Desperately", "Destructive", "Detach", "Detect", "Determined",
            "Determine", "Devastate", "Devastating", "Devote", "Devoted", "Diagnose", "Dictate",
            "Differ", "Diminish", "Dire", "Discard", "Discontinued", "Discontinue", "Discover",
            "Disguise", "Dishonest", "Disintegrate", "Dismiss", "Dismantle", "Disobedient",
            "Disobediently", "Disorder", "Disparate", "Dispel", "Displace", "Display",
            "Displeased", "Disposable", "Dispose of", "Disputably", "Dispute", "Disputed",
            "Disregard", "Disrupt", "Disseminate", "Distant", "Distinct", "Distinctive",
            "Distinguish", "Distinguished", "Distorted", "Distract", "Distressed", "Distribute",
            "Distrustfully", "Diverge", "Divergent", "Diverse", "Divine", "Divorce", "Domestic",
            "Dominate", "Dominant", "Doubtful", "Doubtfully", "Drain", "Dramatic", "Dramatically",
            "Drastic", "Drastically", "Draw out", "Draw up", "Dreadful", "Dubious", "Dubiously",
            "Duplicate", "Durable", "Eager", "Economical", "Efficient", "Elaborate",
            "Elaborately", "Elastic", "Elegant", "Eligible", "Eliminate", "Embarrassing",
            "Embrace", "Emerge", "Emphasize", "Employ", "Empower", "Enable", "Encounter",
            "Encourage", "Endanger", "Enforce", "Enforced", "Engulf", "Enhance", "Enlarge",
            "Enlighten", "Enlist", "Enormous", "Enormously", "Enraged", "Ensuing", "Ensure",
            "Enthusiastic", "Entitled", "Equally", "Equipped", "Equivalent", "Equivalently",
            "Escalate", "Essential", "Essentially", "Establish", "Established", "Estimate",
            "Estrange", "Evacuate", "Evaluate", "Evenly", "Eventually", "Evident", "Evidently",
            "Evolve", "Evolve into", "Exceed", "Exceeding", "Exceedingly", "Excel",
            "Exceptional", "Exceptionally", "Exchange ideas", "Exclude", "Execute", "Exhaust",
            "Exhibit", "Existent", "Exotic", "Expand", "Expanding", "Expel", "Explicit",
            "Explore", "Expose", "Extended", "Extensive", "Extensively", "Extinguisher",
            "Extraordinary", "Extravagant", "Extreme", "Extremely", "Fabricated", "Fabulous",
            "Facilitate", "Factual", "Fade away", "Falsify", "Fanatical", "Far-reaching",
            "Fascinate", "Fascinating", "Faulty", "Favouring", "Fearsome", "Feature", "Fertile",
            "Feverish", "Firmly", "Flexible", "Flee", "Flourish", "Flourishing", "Follow up",
            "For a fraction of", "For the sake of", "Forecast", "Foresight", "Former",
            "Formerly", "Fortify", "Foster", "Found", "Fragile", "Fragment", "Frank",
            "Frustrated", "Fruitful", "Fulfill", "Fulfil", "Function", "Fundamental",
            "Fundamentally", "Gainful", "Gaze at", "Generate", "Genuine", "Gigantic",
            "Glance at", "Gleaming", "Glimpse", "Glimpse at", "Globally", "Gloomy", "Govern",
            "Gradual", "Grant", "Grasp", "Grave", "Guarantee", "Guiltless", "Habitual",
            "Hail", "Harmful", "Harsh", "Harshly", "Hastily", "Hazardous", "Heavenly",
            "Hesitantly", "Highborn", "Highlight", "Hindering", "Hint", "Horrifying",
            "Hostile", "Humble", "Humiliating", "Humorous", "Hurriedly", "Identical", "Idle",
            "Illuminate", "Illustrate", "Imaginative", "Imitation", "Immense", "Immortal",
            "Impaired", "Imperial", "Imperfectly", "Impressive", "Imprisoned", "In a nutshell",
            "In abundance", "In accord with", "In accordance with", "In advance",
            "In alignment with", "In an attempt to", "In an effort to", "In anticipation of",
            "In charge of", "In collaboration with", "In combination with", "In compliance with",
            "In conjunction with", "In contact with", "In detail", "In excess of", "In favor of",
            "In good order", "In isolation", "In line with", "In many respects", "In moderation",
            "In place of", "In possession of", "In preparation for", "In pursuit of",
            "In reality", "In recognition of", "In relation to", "In response to", "In search of",
            "In terms of", "In the context of", "In the course of", "In the face of",
            "In the name of", "In the wake of", "In touch with", "Inaccessible", "Inadequately",
            "Inadequate", "Incidental", "Incidentally", "Inclusive", "Inclusively",
            "Inconsiderate", "Inconsistently", "Incredible", "Incredibly", "Indecisive",
            "Indecisively", "Independently", "Indicate", "Indifferent", "Indifferently",
            "Individual", "Inexpensive", "Infinite", "Influential", "Informally", "Inhuman",
            "Initially", "Inject", "Innocent", "Innovative", "Insane", "Insignificant",
            "Insincere", "Insistent", "Instantly", "Institute", "Instruct", "Insufficiently",
            "Insult", "Intended", "Intensely", "Intentional", "Intentionally", "Interfere",
            "Interpret", "Invaluable", "Invade", "Inventive", "Investigate", "Involve",
            "Irrelevant", "Irreplaceable", "Irritated", "Isolate", "Isolated", "Joint",
            "Joyous", "Justifiable", "Justify", "Keen", "Label", "Largely", "Lasting",
            "Launch", "Leisurely", "Lengthy", "Liable", "Limited", "Locate", "Logical",
            "Logically", "Long for", "Long-term", "Lucid", "Magnificent", "Magnify",
            "Maintain", "Malevolent", "Manipulate", "Manufacture", "Marketable", "Mask",
            "Massive", "Matchless", "Mature", "Mental", "Merciless", "Merge", "Mighty",
            "Minor", "Mischievous", "Misleading", "Mismatched", "Moderate", "Modest",
            "Modify", "Monetary", "Mortal", "Motivate", "Mount", "Mounting", "Mutual",
            "Naive", "Needy", "Neglect", "Neglectfully", "Negligently", "Negotiate",
            "Neutral", "Noble", "Non-stop", "Notable", "Noteworthy", "Notify", "Null",
            "Object to", "Objective", "Objectively", "Obscurely", "Observe", "Obtain",
            "Occupy", "Occur", "Omit", "On behalf of", "On the basis of", "On the grounds of",
            "Oppressively", "Optimistic", "Originate", "Outline", "Outstanding", "Overcome",
            "Overlap", "Overlook", "Overpower", "Overrun", "Particularly", "Participate in",
            "Pave the way for", "Peculiarly", "Perceive", "Perplexed", "Perplexing", "Persist",
            "Persistent", "Persuade", "Persuasively", "Pessimistic", "Phase out", "Picturesque",
            "Pin down", "Plausible", "Plentiful", "Plot", "Plunge", "Ponder", "Portable",
            "Portray", "Pose", "Postpone", "Precise", "Precisely", "Predict", "Preserve",
            "Pretend", "Prevailing", "Primary", "Prior to", "Proficient", "Profitable",
            "Progress", "Prohibit", "Project", "Prolonged", "Promote", "Prompt", "Promptly",
            "Prone", "Proper", "Properly", "Propose", "Prosperous", "Provisionally",
            "Proximate", "Psychological", "Publish", "Punctual", "Purely", "Pursue", "Puzzled",
            "Questionable", "Questionably", "Quote", "Raid", "Rational", "Rationalize",
            "Rebellious", "Recollect", "Recruit", "Redundant", "Refer to", "Refine",
            "Reflect", "Reform", "Regard", "Regardless of", "Regulate", "Rehearse",
            "Reinforce", "Reject", "Relate", "Related", "Release", "Relevant", "Reliable",
            "Reluctantly", "Rely on", "Remark", "Remarkable", "Remote", "Renew", "Renovate",
            "Renowned", "Repel", "Resemble", "Reside", "Resist", "Resolve", "Respectively",
            "Rest on", "Restrain", "Restlessly", "Retain", "Retire", "Retreat", "Reverse",
            "Revise", "Revolutionize", "Rigid", "Roam", "Robust", "Root out", "Ruin",
            "Ruined", "Rule out", "Rural", "Sack", "Satirical", "Scan", "Scarcely",
            "Scatter", "Securely", "Seductive", "Seek", "Seemingly", "Seize", "Sensibly",
            "Sensitive", "Sentenced", "Sequential", "Sequentially", "Severe", "Severely",
            "Shallow", "Shameful", "Shatter", "Shed light on", "Shield", "Shift", "Shoulder",
            "Showy", "Shrinking", "Significant", "Significantly", "Signify", "Simulate",
            "Sincerely", "Single-mindedly", "Skilled", "Slight", "Slightly", "Sluggish",
            "Sluggishly", "Soaring", "Solely", "Sophisticated", "Spark", "Specifically",
            "Specify", "Spectacular", "Speculate", "Stable", "Standardize", "Stark",
            "Startled", "Steep", "Stem from", "Stern", "Stimulate", "Strenuous", "Strengthen",
            "Stress", "Striking", "Struggle", "Stubbornly", "Stunning", "Subject to",
            "Submerge", "Submit", "Subsequent", "Subsequently", "Substantial", "Substantially",
            "Substitute", "Successive", "Successively", "Sufficient", "Suitably", "Summarize",
            "Superior", "Supervise", "Supplement", "Susceptible", "Suspend", "Sustainable",
            "Sustain", "Swift", "Symbolic", "Symbolize", "Sympathetic", "Synonymous",
            "Tackle", "Tactfully", "Tangible", "Tear apart", "Tentative", "Tentatively",
            "Terminate", "Terrifying", "Thorough", "Thoroughly", "Thoughtful", "Thoughtfully",
            "Thoughtless", "Thrive", "Thriving", "To a certain degree", "To a large extent",
            "To this end", "Tolerate", "Torture", "Toughen", "Trace", "Traditional",
            "Transform", "Transmit", "Tremendous", "Trigger", "Typical", "Typically",
            "Ultimate", "Ultimately", "Unanimous", "Unanimously", "Unavoidably", "Unclearly",
            "Unconcernedly", "Under no circumstances", "Under pressure", "Undergo", "Underline",
            "Undermine", "Undertake", "Unequally", "Unevenly", "Unfavourably", "Unify",
            "Unintentionally", "Uninterestedly", "Unite", "Universal", "Universally",
            "Unmask", "Unresponsive", "Unusually", "Unwillingly", "Uphold", "Urge", "Urgent",
            "Urgently", "Utilize", "Vacant", "Vague", "Valid", "Validate", "Valuable",
            "Vanish", "Varied", "Various", "Vary", "Vast", "Verify", "Versatile", "Vibrant",
            "Vigorous", "Vigorously", "Violently", "Visible", "Visualize", "Void",
            "Voluntary", "Voluntarily", "Vulnerable", "Wander", "Warrant", "Weighty", "Wicked",
            "Widespread", "Widely", "Willingly", "With reference to", "With regard to",
            "With the exception of", "With the help of", "With the intention of", "Worldly",
            "Worsen", "Worrisome", "Yearn for", "Yield", "Abbreviate", "Abound", "Acclaimed",
            "Acute", "Adamantly", "Adhere to", "Adherent", "Administer", "Adverse",
            "Adversely", "Affluent", "Affluently", "Aggravate", "Agitated", "Akin to",
            "Allege", "Alleviate", "Allocate", "Alluring", "Ambiguous", "Amplify", "Ample",
            "Annex", "Annihilate", "Antagonistic", "Antecedent", "Apprehensive", "Apt to",
            "Arable", "Arbitrary", "Arbitrarily", "Archaic", "Arduous", "Arid", "Ascertain",
            "Aspire", "Assert", "Assertive", "Assuredly", "At odds with", "At the expense of",
            "Augment", "Austere", "Autonomous", "Autonomously", "Avert", "Avid", "Barren",
            "Belligerent", "Benign", "Bewildering", "Boundless", "Boundlessly", "By and large",
            "Cast light on", "Catastrophic", "Cease", "Celestial", "Chiefly", "Cognitive",
            "Coincide", "Come to terms with", "Commence", "Communal", "Compactly",
            "Compassionate", "Compel", "Compelling", "Complement", "Comply with", "Comprehend",
            "Comprehensive", "Comprehensively", "Comprise", "Conceal", "Concede", "Conceive",
            "Concise", "Concisely", "Concur", "Confer", "Conjunction", "Conscience",
            "Conscientiously", "Consecutive", "Consecutively", "Consent", "Constitute",
            "Convict of", "Convicted", "Copious", "Correspondingly", "Counterfeit",
            "Courteous", "Courteously", "Crave", "Culprit", "Curb", "Curtail", "Customary",
            "Cynical", "Deduce", "Deduce from", "Deem", "Deter", "Deteriorate", "Detrimental",
            "Deviate", "Devise", "Disclose", "Discriminate", "Dwell", "Embark on", "Emit",
            "Empirical", "Enact", "Encompass", "Endemic", "Endorse", "Endure", "Engender",
            "Entail", "Envisage", "Equivocal", "Erect", "Evoke", "Exemplify", "Expend",
            "Exploit", "Extraterrestrial", "Fabricate", "Halt", "Hampering", "Haphazard",
            "Hard-headed", "Harmonious", "Harmoniously", "Harness", "Hasten", "Heartening",
            "Hereditary", "Hinder", "Hypothesize", "Ignite", "Illegitimate", "Illicit",
            "Illustrious", "Imminent", "Impartial", "Impartially", "Imperative",
            "Imperatively", "Implicit", "Imply", "Impose", "Impoverished", "Improbable",
            "Inborn", "Incalculable", "Incessantly", "Incoherent", "Incompatible",
            "Indefinitely", "Indigenous", "Indignant", "Indisputable", "Indispensable",
            "Inevitable", "Inevitably", "Infeasible", "Infamous", "Infer", "Ingenious",
            "Inherent", "Inhibit", "Inhospitable", "Initiate", "Innate", "Inquire",
            "Instigate", "Instinctive", "Insubordinately", "Intact", "Intangible",
            "Intensional", "Interim", "Intervene", "Intricate", "Intrinsic", "Intuitive",
            "Invalidate", "Jubilant", "Laborious", "Lavish", "Legitimate", "Lucrative",
            "Luminous", "Lush", "Malignant", "Malleable", "Maltreat", "Mandate", "Mandatory",
            "Manifest", "Meagre", "Meagrely", "Meditative", "Meticulous", "Miscellaneous",
            "Mitigate", "Monumental", "Monumentally", "Negligible", "Notional", "Notorious",
            "Nullify", "Oblique", "Oblige", "Obligatory", "Obscure", "Obsolete", "Obstinate",
            "Obstinately", "Obstruct", "Obstructive", "Opaque", "Oppress", "Ostentatious",
            "Outmoded", "Overwhelming", "Overwhelmingly", "Paramount", "Pensively",
            "Perilous", "Perplex", "Perpetual", "Perpetually", "Phenomenally", "Plummet",
            "Precede", "Preceding", "Predate", "Predominantly", "Premeditated", "Prerequisite",
            "Presume", "Pretentious", "Prevalent", "Primal", "Primarily", "Primeval",
            "Primitive", "Principal", "Principally", "Proclaim", "Procrastinate", "Profound",
            "Profoundly", "Prolific", "Prominent", "Prosecute", "Provoke", "Radically",
            "Ratify", "Recede", "Recurrent", "Regal", "Render", "Renounce", "Repeal",
            "Resent", "Resilient", "Resolute", "Resolutely", "Retard", "Ruthless", "Scanty",
            "Sceptically", "Scornful", "Scrupulous", "Scrutinize", "Subjective", "Subtle",
            "Supplant", "Suppress", "Surpass", "Unearth", "Unparalleled", "Unravel",
            "Unrivalled", "Utterly"
        ];

        // Mistral AI API Configuration
        // API key is now securely stored in Netlify Environment Variables
        const MISTRAL_API_URL = '/api/mistral';

        // Daily Streak Manager
        class StreakManager {
            constructor() {
                this.loadData();
            }

            loadData() {
                const saved = localStorage.getItem('streakData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.streak = data.streak || 0;
                    this.lastReviewDate = data.lastReviewDate || null;
                    this.wordsReviewedToday = data.wordsReviewedToday || 0;
                    this.lastDate = data.lastDate || null;
                } else {
                    this.streak = 0;
                    this.lastReviewDate = null;
                    this.wordsReviewedToday = 0;
                    this.lastDate = null;
                }
            }

            saveData() {
                localStorage.setItem('streakData', JSON.stringify({
                    streak: this.streak,
                    lastReviewDate: this.lastReviewDate,
                    wordsReviewedToday: this.wordsReviewedToday,
                    lastDate: this.lastDate
                }));
            }

            getTodayKey() {
                return new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            }

            isNewDay() {
                const today = this.getTodayKey();
                return this.lastDate !== today;
            }

            checkAndResetForNewDay() {
                if (this.isNewDay()) {
                    // Check if yesterday's goal was met
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayKey = yesterday.toISOString().split('T')[0];

                    // If last review was not yesterday and not today, streak breaks
                    if (this.lastDate && this.lastDate !== yesterdayKey && this.lastDate !== this.getTodayKey()) {
                        // Missed a day - reset streak
                        this.streak = 0;
                    }

                    // Reset daily counter
                    this.wordsReviewedToday = 0;
                    this.lastDate = this.getTodayKey();
                    this.saveData();
                }
            }

            recordWordReviewed() {
                this.checkAndResetForNewDay();
                
                const wasGoalMet = this.isDailyGoalMet();
                this.wordsReviewedToday++;
                
                // If this is the 10th word and goal wasn't met before, increment streak
                if (this.wordsReviewedToday >= 10 && !wasGoalMet) {
                    this.streak++;
                    this.lastReviewDate = this.getTodayKey();
                }
                
                this.saveData();
                return this.getStatus();
            }

            isDailyGoalMet() {
                this.checkAndResetForNewDay();
                return this.wordsReviewedToday >= 10;
            }

            getStatus() {
                this.checkAndResetForNewDay();
                return {
                    streak: this.streak,
                    wordsReviewedToday: this.wordsReviewedToday,
                    dailyGoal: 10,
                    remaining: Math.max(0, 10 - this.wordsReviewedToday),
                    isGoalMet: this.isDailyGoalMet()
                };
            }

            getProgressPercent() {
                return Math.min((this.wordsReviewedToday / 10) * 100, 100);
            }
        }

        // Spaced Repetition Algorithm
        class SpacedRepetition {
            constructor() {
                this.intervals = [1, 3, 7, 14, 30, 60, 120]; // Days between reviews
                this.loadData();
            }

            loadData() {
                const saved = localStorage.getItem('wordProgress');
                this.progress = saved ? JSON.parse(saved) : {};
            }

            saveData() {
                localStorage.setItem('wordProgress', JSON.stringify(this.progress));
            }

            getWordData(word) {
                if (!this.progress[word]) {
                    this.progress[word] = {
                        level: 0, // 0 = new, 1-7 = learning levels
                        nextReview: Date.now(),
                        correctCount: 0,
                        incorrectCount: 0,
                        lastReviewed: null
                    };
                }
                return this.progress[word];
            }

            processResult(word, known) {
                const data = this.getWordData(word);
                data.lastReviewed = Date.now();

                if (known) {
                    data.correctCount++;
                    if (data.level < this.intervals.length) {
                        data.level++;
                    }
                    // Calculate next review date
                    const daysToAdd = this.intervals[Math.min(data.level - 1, this.intervals.length - 1)];
                    data.nextReview = Date.now() + (daysToAdd * 24 * 60 * 60 * 1000);
                } else {
                    data.incorrectCount++;
                    // Reset to earlier level but not completely
                    data.level = Math.max(0, data.level - 1);
                    // Review again soon (in 10 minutes)
                    data.nextReview = Date.now() + (10 * 60 * 1000);
                }

                this.saveData();
                return data;
            }

            getDueWords() {
                const now = Date.now();
                return MYWORDS.filter(word => {
                    const data = this.getWordData(word);
                    return data.nextReview <= now;
                });
            }

            getStats() {
                let learned = 0;
                let toReview = 0;
                const now = Date.now();

                MYWORDS.forEach(word => {
                    const data = this.getWordData(word);
                    if (data.level >= 4) {
                        learned++;
                    }
                    if (data.nextReview <= now) {
                        toReview++;
                    }
                });

                return { learned, toReview };
            }
        }

        // Cache for word definitions
        const wordCache = {};
        const prefetchQueue = new Set();
        const failedWords = new Set(); // Track words that failed after retries
        const MAX_RETRIES = 3;
        const RETRY_DELAY_BASE = 1000; // Start with 1 second delay

        // Fetch word data from Mistral AI with retry logic
        async function fetchWordData(word, retryCount = 0) {
            if (wordCache[word]) {
                return wordCache[word];
            }

            // Mark as being fetched to prevent duplicate requests
            if (prefetchQueue.has(word)) {
                // Wait for the existing request to complete
                while (!wordCache[word]) {
                    await new Promise(r => setTimeout(r, 50));
                }
                return wordCache[word];
            }

            prefetchQueue.add(word);

            try {
                const response = await fetch(MISTRAL_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        word: word,
                        linkingWord: suggestLinkingWord(),
                        linkingWordsPrompt: getLinkingWordsPrompt()
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('Invalid API response structure');
                }
                
                const content = data.choices[0].message.content;
                
                // Extract JSON from response - try multiple patterns
                let result = null;
                
                // Try to find JSON object in the response
                const jsonMatch = content.match(/\{[\s\S]*?\}/);
                if (jsonMatch) {
                    try {
                        result = JSON.parse(jsonMatch[0]);
                    } catch (parseError) {
                        console.warn('JSON parse failed, trying alternative extraction:', parseError);
                    }
                }
                
                // If no valid JSON, try to extract definition and example manually
                if (!result || !result.definition || !result.example) {
                    result = extractDataFromText(content, word);
                }
                
                // Validate the result has required fields
                if (result && result.definition && result.example) {
                    wordCache[word] = result;
                    failedWords.delete(word); // Remove from failed if previously failed
                    return result;
                } else {
                    throw new Error('Response missing required fields');
                }
                
            } catch (error) {
                console.error(`Error fetching word data for "${word}" (attempt ${retryCount + 1}/${MAX_RETRIES + 1}):`, error);
                
                // Retry logic with exponential backoff
                if (retryCount < MAX_RETRIES) {
                    const delay = RETRY_DELAY_BASE * Math.pow(2, retryCount);
                    console.log(`Retrying in ${delay}ms...`);
                    await new Promise(r => setTimeout(r, delay));
                    prefetchQueue.delete(word);
                    return fetchWordData(word, retryCount + 1);
                }
                
                // All retries exhausted
                failedWords.add(word);
                
                // Show error notification to user (only on final retry)
                if (retryCount === MAX_RETRIES) {
                    showErrorNotification(`Couldn't load "${word}". Using basic definition.`);
                }
                
            } finally {
                prefetchQueue.delete(word);
            }

            // Generate contextual fallback based on word patterns
            const fallback = generateFallbackData(word);
            wordCache[word] = fallback;
            return fallback;
        }

        // Extract data from non-JSON text
        function extractDataFromText(text, word) {
            const result = { definition: '', example: '' };
            
            // Look for definition patterns
            const defPatterns = [
                /definition["']?\s*:?\s*["']?([^"\n]+)/i,
                /means?\s*:?\s*([^\n\.]+)/i,
                /is\s+a[n]?\s+([^\n\.]+)/i,
                /refers?\s+to\s+([^\n\.]+)/i
            ];
            
            for (const pattern of defPatterns) {
                const match = text.match(pattern);
                if (match) {
                    result.definition = match[1].trim();
                    break;
                }
            }
            
            // Look for example patterns
            const examplePatterns = [
                /example["']?\s*:?\s*["']?([^"\n]+)/i,
                /example\s+sentence["']?\s*:?\s*["']?([^"\n]+)/i,
                /"([^"]+)"/,
                /e\.g\.\s*:?\s*([^\n\.]+)/i
            ];
            
            for (const pattern of examplePatterns) {
                const match = text.match(pattern);
                if (match) {
                    result.example = match[1].trim();
                    break;
                }
            }
            
            // Clean up the results
            if (result.definition) {
                result.definition = result.definition.replace(/^["']|["']$/g, '').trim();
            }
            if (result.example) {
                result.example = result.example.replace(/^["']|["']$/g, '').trim();
                // Add word highlighting if not present
                if (!result.example.toLowerCase().includes(word.toLowerCase())) {
                    result.example = `${word} is commonly used in academic contexts.`;
                }
            }
            
            return result;
        }

        // Generate better fallback data based on word patterns with linking words
        function generateFallbackData(word) {
            const lowerWord = word.toLowerCase();
            const linkingWord = suggestLinkingWord();
            
            // Pattern-based fallbacks for common word types - all include linking word
            if (lowerWord.endsWith('ly')) {
                // Adverbs
                return {
                    definition: `In a manner that is ${lowerWord.replace('ly', '')}. Used to modify verbs, adjectives, or other adverbs.`,
                    example: `The student ${lowerWord} completed the assignment; ${linkingWord}, the professor expected even more detail.`
                };
            }
            
            if (lowerWord.endsWith('tion') || lowerWord.endsWith('sion') || lowerWord.endsWith('ment')) {
                // Nouns
                return {
                    definition: `The act, process, or result of ${lowerWord.replace(/(tion|sion|ment)$/, 'ting')}. A concept or state.`,
                    example: `The ${lowerWord} of this theory is significant; ${linkingWord}, many scholars remain skeptical.`
                };
            }
            
            if (lowerWord.endsWith('ing') && !lowerWord.includes(' ')) {
                // Gerunds/present participles
                return {
                    definition: `The process or action of ${lowerWord}. An ongoing activity or state.`,
                    example: `Although ${lowerWord} requires effort, ${linkingWord} the results are worth the investment.`
                };
            }
            
            if (lowerWord.startsWith('un') || lowerWord.startsWith('in') || lowerWord.startsWith('dis')) {
                // Negative prefixes
                const rootWord = lowerWord.replace(/^(un|in|dis)/, '');
                return {
                    definition: `Not ${rootWord}; the opposite or absence of ${rootWord}.`,
                    example: `The findings were ${lowerWord}; ${linkingWord}, subsequent studies have challenged this conclusion.`
                };
            }
            
            if (lowerWord.includes(' ')) {
                // Phrasal verbs or multi-word expressions
                return {
                    definition: `An expression meaning to perform the action described by ${word}. Commonly used in formal contexts.`,
                    example: `Researchers must ${lowerWord} to succeed; ${linkingWord} many struggle to implement this effectively.`
                };
            }
            
            // Default fallback with linking word integrated
            return {
                definition: `Relating to or characterized by ${lowerWord}; an important academic vocabulary term.`,
                example: `Understanding "${word}" is essential for academic success; ${linkingWord}, many students overlook its importance.`
            };
        }

        // Show error notification to user
        function showErrorNotification(message) {
            // Remove any existing error notifications
            const existing = document.querySelector('.error-notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'streak-notification error-notification';
            notification.innerHTML = `
                <div class="streak-notification-content">
                    <span style="font-size: 24px;">âš ï¸</span>
                    <div>
                        <div class="streak-title" style="color: #e67e22;">Connection Issue</div>
                        <div class="streak-subtitle">${message}</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Retry fetching failed words (can be called periodically or on user action)
        async function retryFailedWords() {
            if (failedWords.size === 0) return;
            
            const wordsToRetry = Array.from(failedWords);
            failedWords.clear(); // Clear before retry
            
            for (const word of wordsToRetry) {
                // Remove from cache to force re-fetch
                delete wordCache[word];
            }
            
            // Show retry notification
            showErrorNotification(`Retrying ${wordsToRetry.length} failed word(s)...`);
            
            // Re-fetch current word immediately if it was failed
            if (wordsToRetry.includes(currentCards[currentIndex])) {
                await renderCard();
            }
        }

        // Prefetch only the next word in the background
        function prefetchNextWord() {
            const nextIndex = currentIndex + 1;
            if (nextIndex < currentCards.length) {
                const nextWord = currentCards[nextIndex];
                if (!wordCache[nextWord] && !prefetchQueue.has(nextWord)) {
                    // Fetch in background without awaiting
                    fetchWordData(nextWord).catch(() => {});
                }
            }
        }

        // Device Detection for iPhone 13 Mini optimizations
        function detectDevice() {
            const width = window.screen.width;
            const height = window.screen.height;
            const dpr = window.devicePixelRatio;
            const isStandalone = window.navigator.standalone === true;
            
            // iPhone 13 Mini detection: 375x812 CSS pixels, 3x DPR
            const isIPhone13Mini = (width === 375 && height === 812 && dpr === 3) || 
                                   (width === 812 && height === 375 && dpr === 3); // landscape
            
            if (isIPhone13Mini) {
                document.body.classList.add('iphone-13-mini');
                // Store for use in other functions
                window.isIPhone13Mini = true;
            }
            
            // Add standalone class for installed PWA
            if (isStandalone) {
                document.body.classList.add('standalone');
            }
        }
        
        // Run device detection immediately
        detectDevice();

        // App State
        const sr = new SpacedRepetition();
        const streakManager = new StreakManager();
        let currentCards = [];
        let currentIndex = 0;
        let isProcessing = false;
        let isDataLoading = false;

        // Initialize
        async function init() {
            // Check streak status on app open
            streakManager.checkAndResetForNewDay();
            updateStats();
            updateDailyProgress();
            await loadCards();
        }

        function updateStats() {
            const stats = sr.getStats();
            const streakStatus = streakManager.getStatus();
            document.getElementById('toReviewCount').textContent = stats.toReview;
            document.getElementById('learnedCount').textContent = stats.learned;
            document.getElementById('streakCount').textContent = streakStatus.streak;
            
            const progress = ((MYWORDS.length - stats.toReview) / MYWORDS.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        async function loadCards() {
            const dueWords = sr.getDueWords();
            
            if (dueWords.length === 0) {
                showEmptyState();
                return;
            }

            // Shuffle and take up to 20 cards per session
            const sessionWords = dueWords
                .sort(() => Math.random() - 0.5)
                .slice(0, 20);

            currentCards = sessionWords;
            currentIndex = 0;

            await renderCard();
        }

        async function renderCard() {
            const container = document.getElementById('cardContainer');
            
            if (currentIndex >= currentCards.length) {
                showSessionComplete();
                return;
            }

            const word = currentCards[currentIndex];
            const wordData = sr.getWordData(word);
            
            container.innerHTML = `
                <div class="card" id="currentCard">
                    <div class="level-indicator">Lvl ${wordData.level}</div>
                    <div class="card-badge dont-know" id="badgeDontKnow">NO</div>
                    <div class="card-badge know" id="badgeKnow">YES</div>
                    <div class="word">${word}</div>
                    <div class="divider"></div>
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>
            `;

            // Block swipes while loading data
            isDataLoading = true;

            // Enable swipe on the card
            enableSwipe();

            // Fetch and display word data
            const data = await fetchWordData(word);
            
            // Allow swipes now that data is loaded
            isDataLoading = false;

            // Prefetch next word for smoother experience
            prefetchNextWord();
            
            // Highlight the word in the example
            const highlightedExample = highlightWordInExample(data.example, word);
            
            const card = document.getElementById('currentCard');
            if (card) {
                card.innerHTML = `
                    <div class="level-indicator">Lvl ${wordData.level}</div>
                    <div class="card-badge dont-know" id="badgeDontKnow">NO</div>
                    <div class="card-badge know" id="badgeKnow">YES</div>
                    <div class="word">${word}</div>
                    <div class="divider"></div>
                    <div class="content-scroll">
                        <div>
                            <div class="section-title">Example</div>
                            <div class="example">"${highlightedExample}"</div>
                        </div>
                        <div>
                            <div class="section-title">Definition</div>
                            <div class="definition">${data.definition}</div>
                        </div>
                    </div>

                `;
            }


        }

        function enableSwipe() {
            const card = document.getElementById('currentCard');
            if (!card) return;

            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            const startDrag = (e) => {
                if (isProcessing || isDataLoading) return;
                isDragging = true;
                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                card.style.transition = 'none';
            };

            const drag = (e) => {
                if (!isDragging || isProcessing || isDataLoading) return;
                
                // Prevent page scrolling during swipe
                if (e.type === 'touchmove') {
                    e.preventDefault();
                }
                
                const touch = e.type.includes('mouse') ? e : e.touches[0];
                currentX = touch.clientX;
                const deltaX = currentX - startX;
                const rotation = deltaX * 0.05;
                
                card.style.transform = `translateX(${deltaX}px) rotate(${rotation}deg)`;

                // Show badge in center based on swipe direction with opacity based on distance
                const badgeKnow = document.getElementById('badgeKnow');
                const badgeDontKnow = document.getElementById('badgeDontKnow');
                
                if (deltaX > 30) {
                    const intensity = Math.min((deltaX - 30) / 70, 1);
                    badgeKnow.style.opacity = intensity;
                    badgeKnow.style.transform = `translate(-50%, -50%) scale(${0.8 + intensity * 0.2}) rotate(${8 * intensity}deg)`;
                    badgeDontKnow.style.opacity = 0;
                } else if (deltaX < -30) {
                    const intensity = Math.min((Math.abs(deltaX) - 30) / 70, 1);
                    badgeDontKnow.style.opacity = intensity;
                    badgeDontKnow.style.transform = `translate(-50%, -50%) scale(${0.8 + intensity * 0.2}) rotate(${-8 * intensity}deg)`;
                    badgeKnow.style.opacity = 0;
                } else {
                    badgeKnow.style.opacity = 0;
                    badgeDontKnow.style.opacity = 0;
                }
            };

            const endDrag = () => {
                if (!isDragging || isProcessing || isDataLoading) return;
                isDragging = false;
                
                const deltaX = currentX - startX;
                card.style.transition = 'transform 0.25s ease';

                if (deltaX > 80) {
                    card.classList.add('swiping-right');
                    setTimeout(() => handleKnow(), 250);
                } else if (deltaX < -80) {
                    card.classList.add('swiping-left');
                    setTimeout(() => handleDontKnow(), 250);
                } else {
                    card.style.transform = '';
                    const badgeKnow = document.getElementById('badgeKnow');
                    const badgeDontKnow = document.getElementById('badgeDontKnow');
                    if (badgeKnow) {
                        badgeKnow.classList.remove('show');
                        badgeKnow.style.opacity = '';
                        badgeKnow.style.transform = '';
                    }
                    if (badgeDontKnow) {
                        badgeDontKnow.classList.remove('show');
                        badgeDontKnow.style.opacity = '';
                        badgeDontKnow.style.transform = '';
                    }
                }
            };

            // Touch events - optimized for iPhone
            card.addEventListener('touchstart', startDrag, { passive: true });
            card.addEventListener('touchmove', drag, { passive: false });
            card.addEventListener('touchend', endDrag);
            card.addEventListener('touchcancel', endDrag);

            // Mouse events
            card.addEventListener('mousedown', startDrag);
            card.addEventListener('mousemove', drag);
            card.addEventListener('mouseup', endDrag);
            card.addEventListener('mouseleave', () => {
                if (isDragging) endDrag();
            });
        }

        function handleKnow() {
            if (isProcessing) return;
            isProcessing = true;

            const word = currentCards[currentIndex];
            sr.processResult(word, true);
            
            // Record for daily streak
            const streakStatus = streakManager.recordWordReviewed();
            
            // Show streak notification if goal just met
            if (streakStatus.wordsReviewedToday === 10) {
                showStreakCelebration(streakStatus.streak);
            }
            
            const card = document.getElementById('currentCard');
            if (card) {
                card.classList.add('swiping-right');
            }

            setTimeout(() => {
                currentIndex++;
                updateStats();
                updateDailyProgress();
                renderCard();
                isProcessing = false;
            }, 300);
        }

        function handleDontKnow() {
            if (isProcessing) return;
            isProcessing = true;

            const word = currentCards[currentIndex];
            sr.processResult(word, false);
            
            // Still counts toward daily goal (reviewed word)
            const streakStatus = streakManager.recordWordReviewed();
            
            // Show streak notification if goal just met
            if (streakStatus.wordsReviewedToday === 10) {
                showStreakCelebration(streakStatus.streak);
            }
            
            const card = document.getElementById('currentCard');
            if (card) {
                card.classList.add('swiping-left');
            }

            setTimeout(() => {
                currentIndex++;
                updateStats();
                updateDailyProgress();
                renderCard();
                isProcessing = false;
            }, 300);
        }

        function updateDailyProgress() {
            const status = streakManager.getStatus();
            const progressBar = document.getElementById('dailyProgressFill');
            const progressText = document.getElementById('dailyProgressText');
            
            if (progressBar) {
                progressBar.style.width = streakManager.getProgressPercent() + '%';
            }
            if (progressText) {
                if (status.isGoalMet) {
                    progressText.textContent = `ðŸ”¥ ${status.streak} day streak!`;
                } else {
                    progressText.textContent = `${status.wordsReviewedToday}/10 words today`;
                }
            }
        }

        function showStreakCelebration(streakDays) {
            // Create celebration notification
            const notification = document.createElement('div');
            notification.className = 'streak-notification';
            notification.innerHTML = `
                <div class="streak-notification-content">
                    <span class="streak-fire">ðŸ”¥</span>
                    <div>
                        <div class="streak-title">Daily Goal Met!</div>
                        <div class="streak-subtitle">${streakDays} day streak</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showEmptyState() {
            const container = document.getElementById('cardContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <h2>ðŸŽ‰ All Caught Up!</h2>
                    <p>You have no words due for review right now.</p>
                    <p>Come back later for more practice!</p>
                    <button class="btn-primary" onclick="resetProgress()">Start Fresh</button>
                </div>
            `;
            document.getElementById('controls').style.display = 'none';
        }

        function showSessionComplete() {
            const container = document.getElementById('cardContainer');
            const stats = sr.getStats();
            container.innerHTML = `
                <div class="empty-state">
                    <h2>ðŸŽ¯ Session Complete!</h2>
                    <p>You reviewed ${currentCards.length} words.</p>
                    <p>Words learned: ${stats.learned} / ${MYWORDS.length}</p>
                    <button class="btn-primary" onclick="loadCards()">Continue Learning</button>
                </div>
            `;
            document.getElementById('controls').style.display = 'none';
        }

        function resetProgress() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                localStorage.removeItem('wordProgress');
                localStorage.removeItem('streakData');
                location.reload();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                handleKnow();
            } else if (e.key === 'ArrowLeft') {
                handleDontKnow();
            }
        });

        // Highlight word in example sentence (case-insensitive, preserves original casing)
        function highlightWordInExample(example, word) {
            if (!example || !word) return example;
            
            // Escape special regex characters in the word
            const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            
            // Create regex that matches the word with word boundaries, case-insensitive
            const regex = new RegExp(`\\b(${escapedWord})\\b`, 'gi');
            
            // Replace with highlighted version (preserving original case)
            return example.replace(regex, '<span class="highlight-word">$1</span>');
        }

        // iOS-specific optimizations
        document.addEventListener('gesturestart', (e) => e.preventDefault());
        document.addEventListener('gesturechange', (e) => e.preventDefault());
        document.addEventListener('gestureend', (e) => e.preventDefault());
        
        // Prevent double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        // Modal functions
        function showInfoModal() {
            const modal = document.getElementById('infoModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeInfoModal(event) {
            if (event && event.target !== event.currentTarget && event.type !== 'click') {
                return;
            }
            const modal = document.getElementById('infoModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Word List Modal Functions
        let currentFilter = 'all';
        let wordListData = [];

        function showWordListModal() {
            const modal = document.getElementById('wordListModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Prepare word data
            prepareWordListData();
            
            // Update summary
            updateWordListSummary();
            
            // Render list
            renderWordList();
        }

        function closeWordListModal(event) {
            if (event && event.target !== event.currentTarget && event.type !== 'click') {
                return;
            }
            const modal = document.getElementById('wordListModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        function prepareWordListData() {
            wordListData = MYWORDS.map(word => {
                const data = sr.getWordData(word);
                return {
                    word: word,
                    level: data.level,
                    nextReview: data.nextReview,
                    correctCount: data.correctCount,
                    incorrectCount: data.incorrectCount,
                    status: data.level >= 4 ? 'learned' : (data.level > 0 ? 'learning' : 'new')
                };
            });
        }

        function updateWordListSummary() {
            const total = wordListData.length;
            const learned = wordListData.filter(w => w.status === 'learned').length;
            const learning = wordListData.filter(w => w.status === 'learning').length;
            const progress = total > 0 ? Math.round((learned / total) * 100) : 0;
            
            document.getElementById('totalWordsCount').textContent = total;
            document.getElementById('learnedWordsCount').textContent = learned;
            document.getElementById('learningWordsCount').textContent = learning;
            document.getElementById('progressPercent').textContent = progress + '%';
        }

        function filterWords(filter) {
            currentFilter = filter;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            
            renderWordList();
        }

        function searchWords() {
            renderWordList();
        }

        function renderWordList() {
            const container = document.getElementById('wordListContainer');
            const searchTerm = document.getElementById('wordSearch').value.toLowerCase();
            
            let filtered = wordListData;
            
            // Apply status filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(w => w.status === currentFilter);
            }
            
            // Apply search filter
            if (searchTerm) {
                filtered = filtered.filter(w => w.word.toLowerCase().includes(searchTerm));
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-list">
                        <div class="empty-list-icon">ðŸ”</div>
                        <div class="empty-list-text">No words found</div>
                    </div>
                `;
                return;
            }
            
            // Group by status
            const groups = {};
            filtered.forEach(w => {
                const groupKey = w.status === 'learned' ? 'âœ“ Learned' : 
                                w.status === 'learning' ? 'ðŸ“š Learning' : 'ðŸ†• New';
                if (!groups[groupKey]) groups[groupKey] = [];
                groups[groupKey].push(w);
            });
            
            // Sort groups: Learned first, then Learning, then New
            const groupOrder = ['âœ“ Learned', 'ðŸ“š Learning', 'ðŸ†• New'];
            
            let html = '';
            groupOrder.forEach(groupName => {
                if (groups[groupName]) {
                    const words = groups[groupName].sort((a, b) => a.word.localeCompare(b.word));
                    
                    html += `
                        <div class="word-group">
                            <div class="word-group-title">${groupName} (${words.length})</div>
                    `;
                    
                    words.forEach(w => {
                        const progressPercent = Math.min((w.level / 7) * 100, 100);
                        const nextReviewText = getNextReviewText(w.nextReview);
                        
                        html += `
                            <div class="word-item">
                                <div class="word-info">
                                    <div class="word-name">${w.word}</div>
                                    <div class="word-status">
                                        <span class="level-badge ${w.status}">Lvl ${w.level}</span>
                                        <span class="next-review">${nextReviewText}</span>
                                    </div>
                                </div>
                                <div class="word-progress">
                                    <div class="word-progress-bar ${w.status}" style="width: ${progressPercent}%"></div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                }
            });
            
            container.innerHTML = html;
        }

        function getNextReviewText(nextReview) {
            const now = Date.now();
            const diff = nextReview - now;
            
            if (diff <= 0) return 'Due now';
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `in ${days}d`;
            if (hours > 0) return `in ${hours}h`;
            return 'Soon';
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeInfoModal();
                closeWordListModal();
            }
        });

        // Keyboard navigation for card controls
        document.addEventListener('keydown', (e) => {
            // Only respond if no modal is open and not currently processing
            const infoModal = document.getElementById('infoModal');
            const wordListModal = document.getElementById('wordListModal');
            
            if (isProcessing) return;
            if (infoModal && infoModal.classList.contains('show')) return;
            if (wordListModal && wordListModal.classList.contains('show')) return;
            if (currentCards.length === 0) return;

            switch (e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    handleDontKnow();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    handleKnow();
                    break;
            }
        });

        // Start the app
        init();
    </script>
</body>
</html>
